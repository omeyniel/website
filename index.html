<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="assets/logo.jpg" />
  <title>Meyniel.ca</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <header class="site-header home-header">
    <div class="container header-row">
      <div class="brand">
        <img src="assets/logo.jpg" alt="meyniel.ca" class="logo" onerror="this.style.display='none'"/>
        <div class="brand-text">
          <h1>Bienvenue</h1>
          <p class="subtitle home-subtitle">&nbsp;</p>
        </div>
      </div>
    </div>
    <nav class="container nav">
      <a href="darwin.html">Darwin</a>
      <a href="/tetris/" class="tool-link">ðŸŽ® Tetris</a>
      <a href="/pdfedit/">Ã‰diteur PDF</a>
    </nav>
  </header>

  <main class="container content home-content">
    <section class="intro-card">
      <h2>En bref</h2>
      <p class="intro">Curieux, toucheâ€‘Ã â€‘tout, bricoleur. Jâ€™ai crÃ©Ã© ce site pour garantir un accÃ¨s permanent et simple aux Ã©pisodes du podcast Â« Sur les Ã©paules de Darwin Â». Je lâ€™enrichis sans but prÃ©cis, juste pour le plaisir.</p>
    </section>

    <section class="message-card" id="commentaire">
      <h2>Un commentaire&nbsp;?</h2>
      <p class="message-note">500 caractÃ¨res maximum. Nom et email obligatoires.</p>
      <form class="message-form" id="message-form">
        <div class="form-grid">
          <label>
            Nom
            <input type="text" name="name" autocomplete="name" required />
          </label>
          <label>
            Email
            <input type="email" name="email" autocomplete="email" required />
          </label>
        </div>
        <label class="message-field">
          Message
          <textarea name="message" rows="7" maxlength="500" required></textarea>
        </label>
        <div class="form-row">
          <span class="char-count"><span id="char-remaining">500</span> caractÃ¨res restants</span>
          <button type="submit" id="message-submit">Envoyer</button>
        </div>
        <p class="form-status" id="form-status" role="status" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Â© 2025 Touchatoutix</p>
    </div>
  </footer>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyMmUBVdI5P3xX59dDvhAH83b9kmU7MMQeuwo7SOdGXKPXLa6CAPlWGQ9ctS5TycdqW_g/exec";
    const MAX_LEN = 500;

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("message-form");
      const messageField = form.querySelector("textarea[name='message']");
      const remaining = document.getElementById("char-remaining");
      const status = document.getElementById("form-status");
      const submit = document.getElementById("message-submit");

      const updateRemaining = () => {
        const left = Math.max(0, MAX_LEN - messageField.value.length);
        remaining.textContent = left;
      };

      updateRemaining();
      messageField.addEventListener("input", updateRemaining);

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        status.textContent = "";

        const name = form.name.value.trim();
        const email = form.email.value.trim();
        const message = messageField.value.trim();

        if (!name || !email || !message) {
          status.textContent = "Merci de remplir tous les champs.";
          return;
        }
        if (message.length > MAX_LEN) {
          status.textContent = "Message trop long.";
          return;
        }

        submit.disabled = true;
        status.textContent = "Envoi en coursâ€¦";

        try {
          const payload = new URLSearchParams({
            name,
            email,
            message,
            userAgent: navigator.userAgent
          });
          await fetch(WEBAPP_URL, {
            method: "POST",
            mode: "no-cors",
            body: payload
          });

          form.reset();
          updateRemaining();
          status.textContent = "Merci, message envoyÃ©.";
        } catch (err) {
          status.textContent = "Erreur lors de lâ€™envoi.";
        } finally {
          submit.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
